System Documentation: Project hticket (Invite-Only Ticket Service)Version: 1.0Status: Approved for DevelopmentMethodology: ScrumTarget Audience: Backend & Frontend Developers1. Executive SummaryProject Nexus is a closed-loop, invite-only project management and ticketing platform. Unlike standard SaaS platforms, users cannot self-register. Access is granted strictly via email invitations generated by Project Managers.Key Technical Constraint: The frontend will utilize Django Templates. However, to provide a modern User Experience (UX), all Create, Read, Update, and Delete (CRUD) operations—such as creating tickets or editing projects—must occur within Modal Popups without full page reloads. This will be achieved using HTMX.2. Technology StackBackend: Python 3.11+, Django 5.0+Database: PostgreSQL (Production), SQLite (Development)Frontend Rendering: Django Standard Templates (Dumas)Frontend Interactivity: HTMX (for AJAX/Modals), Hyperscript or Alpine.js (optional for light UI logic).CSS Framework: Bootstrap 5 (Chosen for robust native Modal support) or Tailwind CSS.Async Tasks: Celery + Redis (Required for sending invitation emails).3. Database Schema & Models3.1. Custom User Model (accounts app)Extends AbstractUser. Used for authentication.Field NameTypeConstraintsDescriptionidUUIDPrimary KeyUUID is safer for URLs than Integer IDs.emailEmailFieldUniqueUsed as the USERNAME_FIELD.roleCharFieldChoicesMANAGER (Admin/Inviter), MEMBER (Standard).avatarImageFieldNullableProfile picture.3.2. Invitation Model (invitations app)The gatekeeper logic. This model replaces standard registration.Field NameTypeConstraintsDescriptiontokenUUIDUnique, Default=uuid4The secret key sent in the email link.emailEmailFieldIndexThe email being invited.senderFK (User)The Manager who sent the invite.projectFK (Project)NullableIf set, user is auto-added to this project upon join.is_usedBooleanDefault=FalsePrevents reuse of links.expires_atDateTimeInvite validity period (e.g., 48 hours).3.3. Project Model (projects app)Field NameTypeConstraintsDescriptionnameCharFieldMax 200descriptionTextFieldmembersM2M (User)Related Name=projectsUsers allowed to view/post in this project.created_byFK (User)3.4. Ticket Model (tickets app)Field NameTypeConstraintsDescriptionprojectFK (Project)OnDelete=CascadereporterFK (User)User who created the issue.titleCharFieldMax 200descriptionTextFieldSupports Markdown/Rich Text.statusCharFieldChoicesOPEN, IN_PROGRESS, REVIEW, DONE.priorityCharFieldChoicesLOW, MEDIUM, HIGH, CRITICAL.created_atDateTimeAutoNowAdd4. Frontend Architecture: The HTMX Modal PatternTo satisfy the requirement "All CRUD operations in popups," developers must strictly follow this pattern.4.1. The Base Template (base.html)The base template must contain a placeholder div that serves as the container for all modals.<!-- Load HTMX -->
<script src="[https://unpkg.com/htmx.org@1.9.10](https://unpkg.com/htmx.org@1.9.10)"></script>

<!-- Main Application Content -->
<main>
    {% block content %}{% endblock %}
</main>

<!-- THE MODAL CONTAINER -->
<!-- This div is empty by default. HTMX will inject modal HTML here. -->
<div id="modal" class="modal fade" tabindex="-1" aria-hidden="true">
    <div id="dialog" class="modal-dialog" hx-target="this"></div>
</div>
4.2. The Trigger (Button)Buttons do not link to a new page. They use hx-get to fetch a partial HTML form.<button hx-get="{% url 'ticket_create' project.id %}" 
        hx-target="#dialog" 
        data-bs-toggle="modal" 
        data-bs-target="#modal">
    Create Ticket
</button>
4.3. The View Logic (Python)Views must detect if the request is standard or HTMX.def ticket_create(request, project_id):
    if request.method == "POST":
        form = TicketForm(request.POST)
        if form.is_valid():
            ticket = form.save()
            # HTMX Magic: Return HTTP 204 (No Content) with a Trigger header
            # This tells the frontend to update the list without a reload
            return HttpResponse(status=204, headers={'HX-Trigger': 'ticketListUpdated'})
    else:
        form = TicketForm()
    
    # Render ONLY the form partial, not the whole base.html
    return render(request, 'tickets/partials/ticket_form.html', {'form': form})
5. Scrum Use Cases & Functional RequirementsThese use cases define the acceptance criteria for Sprints.Epic 1: Authentication & InvitationsUse Case 1.1: Manager Invites UserActor: Project Manager.Pre-condition: Manager is logged in.Flow:Manager clicks "Invite Member" (Popup opens).Manager inputs email john@example.com.System checks if john@example.com is already a user.System creates Invitation record with UUID.System sends email via SMTP/Console.Post-condition: Email sent, Invitation record exists.Use Case 1.2: User Registration (Invite Acceptance)Actor: Invited Guest.Pre-condition: Guest has a link: domain.com/join/<uuid>/.Flow:Guest navigates to link.System validates UUID exists and is_used=False.Guest sees Registration Form (Email pre-filled and Read-Only).Guest enters Password and Confirm Password.System creates User, sets Invitation.is_used=True.System logs user in and redirects to Dashboard.Epic 2: Dashboard & ProjectsUse Case 2.1: Project IsolationActor: Member.Rule: User A should only see Projects they are added to in the members M2M field.Implementation: Use Project.objects.filter(members=request.user) in the dashboard view.Epic 3: Ticket Management (Popup Heavy)Use Case 3.1: Create TicketActor: Member.Flow:User clicks "Add Ticket" on Project Board.Modal loads ticket_form.html.User fills details.Validation Error: If form is invalid, Modal re-renders with error messages (no page refresh).Success: Modal closes, and the Ticket List updates instantly (via hx-trigger="ticketListUpdated").Use Case 3.2: Edit Ticket StatusActor: Member / Manager.Flow:User clicks on a Ticket card.Modal opens with Ticket Details.User changes Status dropdown from "Open" to "In Progress".System saves change via AJAX.6. Security & PermissionsLogin Required: All views (except the "Join via Token" view) require @login_required.Project Membership Check:Middleware or Decorator needed: Before allowing a Ticket Create/Update, check:if request.user not in project.members.all() and not request.user.is_manager:
    raise PermissionDenied
CSRF Protection: Ensure all HTMX requests include the CSRF token.Add hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}' to the body tag or setup HTMX CSRF in JS.7. Development SetupPrerequisitesPython 3.11+Redis (for Celery)Initial SetupClone & Venv:git clone <repo>
python -m venv venv
source venv/bin/activate  # or venv\Scripts\activate on Windows
Dependencies:pip install django psycopg2-binary django-htmx django-crispy-forms celery redis
Environment Variables (.env):DEBUG=True
SECRET_KEY=change_me
DB_NAME=nexus_db
DB_USER=postgres
DB_PASSWORD=postgres
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend # For dev
Migrations (Critical):Ensure AUTH_USER_MODEL = 'accounts.User' is in settings.py before the first migration.python manage.py makemigrations
python manage.py migrate
